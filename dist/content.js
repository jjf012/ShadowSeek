function f(o){const s=location.href,r=[],t=new Set;Array.from(document.scripts).forEach((e,n)=>{const c=e.getAttribute("src"),i=c?new URL(c,s).href:`${s}#inline-${n}`;t.has(i)||(t.add(i),r.push({url:i,inline:!c,content:o?e.textContent??"":void 0}))});try{performance.getEntriesByType("resource").forEach(n=>{const c=n.name;if(!c||t.has(c))return;const i=c.toLowerCase();(n.initiatorType==="script"||i.endsWith(".js")||i.includes(".js?")||i.includes("/js/"))&&(t.add(c),r.push({url:c,inline:!1,content:void 0}))})}catch(e){console.warn("收集 performance 资源失败",e)}return Array.from(document.querySelectorAll('link[rel="preload"][as="script"],link[rel="modulepreload"]')).forEach(e=>{const n=e.href;!n||t.has(n)||(t.add(n),r.push({url:n,inline:!1}))}),r}function a(o,s){if(!o)return null;const r=o.trim();if(!r||/^(javascript:|mailto:|tel:|data:|blob:)/i.test(r))return null;try{const t=new URL(r,s);return t.protocol!=="http:"&&t.protocol!=="https:"?null:(t.hash="",t.href)}catch{return null}}function h(){const o=[];try{const s=document.documentElement?.outerHTML??"";o.push({url:location.href,inline:!0,content:s})}catch{}try{Array.from(document.querySelectorAll("iframe")).forEach((r,t)=>{try{const n=r.contentDocument?.documentElement?.outerHTML;if(!n)return;const c=r.getAttribute("src"),i=a(c,location.href)??`${location.href}#iframe-${t}`;o.push({url:i,inline:!0,content:n})}catch{}})}catch{}return o}function d(){const o=location.href,s=[],r=new Set,t=Array.from(document.querySelectorAll("[href],[src]"));for(const e of t){const n=e.getAttribute?.("href"),c=e.getAttribute?.("src"),i=[n,c];for(const u of i){const l=a(u,o);l&&(r.has(l)||(r.add(l),s.push(l)))}}return s}function m(){const o=[],s=new Set,r=t=>/\/(api|graphql|rpc|rest|v\d+|ws|wss)\b/i.test(t)||/(fetch|axios|xmlhttprequest)/i.test(t);try{performance.getEntriesByType("resource").forEach(e=>{if(!e.name||s.has(e.name))return;const n=e.initiatorType;!(n==="xmlhttprequest"||n==="fetch")&&!r(e.name)||(s.add(e.name),o.push({url:e.name,method:void 0}))})}catch(t){console.warn("收集接口资源失败",t)}return o}chrome.runtime.onMessage.addListener((o,s,r)=>{if(o.type==="COLLECT_SCRIPTS"){const t=f(!!o.includeInline),e=m(),n=h(),c=d();return r({scripts:t,endpoints:e,documents:n,targets:c}),!0}return!1});
